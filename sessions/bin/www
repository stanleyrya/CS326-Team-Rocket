#!/usr/bin/env node
var debug = require('debug')('sessions');
var app = require('../app');

app.set('port', process.env.PORT || 3000);

var server = app.listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
});

var io = require('socket.io').listen(server);

//online = {};

io.on('connection', function(socket){
    console.log('connected to chat!');
    var user;
    socket.on('new user', function(user){
    	user = thisuser;
    	user.socket = socket;
    	online[user.fname] = user;
    	console.log('set user?');
    });
    socket.on('chat message', function(msg){
    	//var msg = data[0];
    	//var thisuser = data[1];
    	//checkOnline(thisuser,socket);
        if(msg === 'Squirtle'){//user.choice){
            var client = require('../lib/db/client.js');
            client.getData('endGame',function(data){
                console.log(data);
            })
        }
        io.emit('chat message', msg);
    });
});

// function checkOnline(user, socket){
// 	if(online[user.fname] === null){
//     	user.socket = socket;
//     	online[user.fname] = user;
//     	console.log('set user?');
// 	}
// }
